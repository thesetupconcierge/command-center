<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Concierge ‚Äî Master Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style id="main-styles">
        /* ========== THEMES & VARIABLES ========== */
        :root {
            --bg: #0a0a0f;
            --bg-card: rgba(255, 255, 255, 0.04);
            --bg-card-hover: rgba(255, 255, 255, 0.07);
            --border: rgba(255, 255, 255, 0.08);
            --text: #e4e4e7;
            --text-dim: #71717a;
            --text-bright: #fafafa;
            --radius: 16px;
            --radius-sm: 10px;

            /* Colors */
            --gold: #FFB81C;
            --gold-dim: rgba(255, 184, 28, 0.15);
            --blue: #3b82f6;
            --blue-dim: rgba(59, 130, 246, 0.15);
            --green: #4ade80;
            --green-dim: rgba(74, 222, 128, 0.15);
            --red: #ef4444;
            --red-dim: rgba(239, 68, 68, 0.15);
            --orange: #f59e0b;
            --orange-dim: rgba(245, 158, 11, 0.15);
            --purple: #a78bfa;
            --purple-dim: rgba(167, 139, 250, 0.15);
            --cyan: #22d3ee;
            --cyan-dim: rgba(34, 211, 238, 0.15);

            /* Business Theme (Default) */
            --primary: var(--gold);
            --primary-dim: var(--gold-dim);
            --accent: var(--green);
            --accent-dim: var(--green-dim);
        }

        [data-theme="career"] {
            --primary: var(--cyan);
            --primary-dim: var(--cyan-dim);
            --accent: var(--blue);
            --accent-dim: var(--blue-dim);
        }

        /* ========== RESET & BASE ========== */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 14px;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            transition: background 0.5s ease;
        }

        /* Ambient glow */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(ellipse at 20% 20%, var(--primary-dim) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, var(--accent-dim) 0%, transparent 50%);
            z-index: -1;
            transition: all 0.5s ease;
        }

        /* ========== SCROLLBAR ========== */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* ========== GLOBAL STATUS BAR ========== */
        .status-bar {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(10, 10, 15, 0.85);
            -webkit-backdrop-filter: blur(24px);
            backdrop-filter: blur(24px);
            border-bottom: 1px solid var(--border);
            padding: 10px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        .status-items {
            display: flex;
            align-items: center;
            gap: 32px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-label {
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.06em;
            font-size: 0.65rem;
        }

        .status-value {
            color: var(--text-bright);
        }

        .status-link {
            color: var(--text-dim);
            text-decoration: none;
            font-size: 0.65rem;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: color 0.2s;
        }

        .status-link:hover {
            color: var(--primary);
        }

        .revenue-mini-bar {
            width: 100px;
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
        }

        .revenue-mini-fill {
            height: 100%;
            background: var(--gold);
            transition: width 1s ease;
        }

        /* ========== HUD NAV (Context Switching) ========== */
        .hud-nav {
            background: var(--bg-card);
            padding: 4px;
            border-radius: 30px;
            display: flex;
            gap: 4px;
            border: 1px solid var(--border);
        }

        .nav-btn {
            padding: 6px 18px;
            border-radius: 26px;
            font-size: 0.78rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            background: transparent;
            color: var(--text-dim);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn.active {
            background: var(--primary);
            color: #000;
            box-shadow: 0 4px 15px var(--primary-dim);
        }

        /* ========== LAYOUT ========== */
        .main {
            max-width: 1600px;
            margin: 0 auto;
            padding: 24px;
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            gap: 24px;
        }

        /* ========== CARDS ========== */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            -webkit-backdrop-filter: blur(12px);
            backdrop-filter: blur(12px);
            transition: border-color 0.2s;
            margin-bottom: 24px;
            position: relative;
            scroll-margin-top: 80px;
            /* Account for sticky header */
        }

        .card-title {
            font-size: 0.72rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-dim);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-title .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        /* ========== SIDEBARS ========== */
        .left-col,
        .right-col {
            display: flex;
            flex-direction: column;
        }

        /* Progress Rings */
        .big-ring-wrap {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 0;
        }

        .big-ring {
            width: 140px;
            height: 140px;
            position: relative;
            margin-bottom: 12px;
        }

        .big-ring svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .big-ring circle {
            fill: none;
            cx: 70;
            cy: 70;
            r: 62;
            stroke-width: 8;
        }

        .big-ring .bg {
            stroke: var(--border);
        }

        .big-ring .fill {
            stroke-linecap: round;
            transition: stroke-dashoffset 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .big-ring-pct {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .big-ring-pct .num {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--text-bright);
            line-height: 1;
        }

        .big-ring-pct .label {
            font-size: 0.7rem;
            color: var(--text-dim);
        }

        .task-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
        }

        .deeplink-btn {
            opacity: 0;
            cursor: pointer;
            transition: opacity 0.2s;
            color: var(--text-dim);
            font-size: 0.8rem;
        }

        .task-section-header:hover .deeplink-btn {
            opacity: 1;
        }

        .deeplink-btn:hover {
            color: var(--primary);
        }

        .section-highlight {
            animation: highlight-pulse 2s ease-out;
        }

        /* Automatic Highlight via CSS :target */
        section:target,
        .card:target {
            animation: highlight-pulse 2s ease-out;
            border-color: var(--primary) !important;
        }

        @keyframes highlight-pulse {
            0% {
                box-shadow: 0 0 0 0 var(--primary-dim);
                border-color: var(--primary);
            }

            50% {
                box-shadow: 0 0 30px 0 var(--primary-dim);
                border-color: var(--primary);
            }

            100% {
                box-shadow: 0 0 0 0 transparent;
                border-color: var(--border);
            }
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.82rem;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        /* ========== TASK LISTS ========== */
        .task-section-header {
            padding: 10px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            user-select: none;
        }

        .section-title {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--text-bright);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-badge {
            font-size: 0.65rem;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 700;
        }

        .section-chevron {
            transition: transform 0.3s;
            color: var(--text-dim);
            font-size: 0.8rem;
        }

        .section-header.collapsed .section-chevron {
            transform: rotate(-90deg);
        }

        .task-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 12px;
            border-radius: var(--radius-sm);
            transition: background 0.15s;
            cursor: pointer;
        }

        @media (max-width: 600px) {
            .task-item {
                padding: 16px 12px;
            }
        }

        .task-item:hover {
            background: var(--bg-card-hover);
        }

        .task-check {
            width: 24px;
            height: 24px;
            min-width: 24px;
            border-radius: 6px;
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 1px;
        }

        .task-check:hover {
            border-color: var(--primary);
        }

        .task-check[data-state="progress"] {
            border-color: var(--orange);
            background: var(--orange-dim);
        }

        .task-check[data-state="progress"]::after {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--orange);
        }

        .task-check[data-state="done"] {
            background: var(--accent);
            border-color: var(--accent);
        }

        .task-check[data-state="done"]::after {
            content: '‚úì';
            color: #000;
            font-weight: 800;
            font-size: 0.85rem;
        }

        .task-text {
            font-size: 0.88rem;
            color: var(--text);
            line-height: 1.5;
            word-break: break-word;
            overflow-wrap: anywhere;
        }

        .task-item[data-status="done"] .task-text {
            text-decoration: line-through;
            opacity: 0.5;
        }

        /* ========== SPOTLIGHT ========== */
        .spotlight-card {
            border: 1px solid var(--primary);
            background: var(--primary-dim);
            border-radius: var(--radius);
        }

        .action-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
        }

        .action-item:last-child {
            border-bottom: none;
        }

        .action-check {
            width: 18px;
            height: 18px;
            min-width: 18px;
            border-radius: 50%;
            border: 2px solid var(--primary);
            margin-top: 2px;
        }

        .action-item.completed {
            opacity: 0.4;
            text-decoration: line-through;
        }

        .action-item.completed .action-check {
            background: var(--primary);
        }

        /* ========== LOG ========== */
        .log-entries {
            max-height: 400px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .log-entry {
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: var(--radius-sm);
            border-left: 3px solid var(--border);
        }

        .log-time {
            font-size: 0.65rem;
            color: var(--text-dim);
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
        }

        .log-text {
            font-size: 0.82rem;
            line-height: 1.4;
            word-break: break-word;
            overflow-wrap: anywhere;
        }

        /* ========== UTILS ========== */
        .fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Settings Overlay */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .overlay.open {
            display: flex;
        }

        .settings-modal {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 32px;
            width: 400px;
            max-width: 90vw;
            box-shadow: 0 24px 60px rgba(0, 0, 0, 0.5);
        }

        .settings-modal h2 {
            margin-bottom: 24px;
            color: var(--text-bright);
        }

        .input-field {
            width: 100%;
            padding: 10px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            margin-bottom: 16px;
            font-family: inherit;
        }

        .quiz-modal {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            width: 100%;
            max-width: 500px;
            position: relative;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .quiz-option {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85rem;
        }

        .quiz-option:hover {
            background: var(--bg-card-hover);
            border-color: var(--primary);
        }

        .quiz-option.selected {
            border-color: var(--primary);
            background: rgba(255, 184, 28, 0.1);
        }

        .diag-badge {
            background: var(--gold-dim);
            color: var(--gold);
            font-size: 0.6rem;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            margin-top: 8px;
        }

        .hub-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        /* Column Stabilization */
        .left-col,
        .center-col,
        .right-col {
            min-width: 0;
        }

        /* ========== MOBILE RESPONSIVENESS ========== */
        /* ========== ULTRA-CONDENSED MOBILE ========== */
        @media (max-width: 1024px) {
            .main {
                grid-template-columns: 1fr;
                padding: 12px;
                gap: 12px;
                display: flex;
                flex-direction: column;
            }

            .left-col,
            .right-col {
                order: 2;
            }

            .center-col {
                order: 1;
            }

            .status-bar {
                padding: 4px 8px;
                flex-wrap: nowrap;
                z-index: 2001;
            }

            .status-items {
                gap: 8px;
                flex: 1;
                justify-content: flex-start;
            }

            #hub-title,
            .branding-logo,
            .status-bar .business-only .status-label,
            .status-bar .status-link,
            .status-bar .business-only:not(#global-revenue):not(.revenue-mini-fill) {
                display: none !important;
            }

            .status-bar::before {
                content: 'SC';
                display: flex;
                align-items: center;
                justify-content: center;
                width: 20px;
                height: 20px;
                background: linear-gradient(135deg, var(--gold), #e6a000);
                color: #000;
                border-radius: 4px;
                font-weight: 800;
                font-size: 0.6rem;
                margin-right: 6px;
            }

            .status-item#global-revenue {
                width: auto;
                margin: 0;
                padding: 0;
                border: none;
                font-size: 0.7rem;
                gap: 4px;
                display: flex;
                align-items: center;
            }

            .revenue-mini-bar {
                width: 30px;
                height: 3px;
                margin: 0;
            }

            .hud-nav {
                width: 100%;
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 4px;
                margin-bottom: 6px;
            }

            .nav-btn {
                padding: 6px 8px;
                font-size: 0.7rem;
            }

            .nav-btn#btn-registry {
                grid-column: span 2;
            }

            .big-ring {
                width: 60px;
                height: 60px;
            }

            .stat-row {
                padding: 4px 0;
                font-size: 0.7rem;
            }

            .card {
                padding: 14px;
            }
        }

        .nav-btn {
            justify-content: center;
            padding: 10px;
            font-size: 0.85rem;
        }

        .big-ring {
            width: 100px;
            height: 100px;
        }

        .big-ring-pct .num {
            font-size: 1.6rem;
        }

        .finance-grid {
            grid-template-columns: 1fr;
        }

        /* ========== REGISTRY HUB STYLES ========== */
        .registry-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            width: 100%;
        }

        .registry-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 14px 18px;
            border-radius: var(--radius-sm);
            transition: all 0.2s ease;
        }

        .registry-item:hover {
            border-color: var(--primary);
            background: var(--bg-card-hover);
            transform: translateY(-2px);
        }

        .registry-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 0;
            flex: 1;
        }

        .registry-name {
            font-size: 0.88rem;
            font-weight: 600;
            color: var(--text-bright);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .registry-meta {
            font-size: 0.65rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .registry-actions {
            display: flex;
            gap: 8px;
            margin-left: 12px;
        }

        .action-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s;
            border: 1px solid var(--border);
        }

        .action-icon:hover {
            background: var(--primary);
            color: #000;
            border-color: var(--primary);
        }

        .action-icon.pdf:hover {
            background: var(--red);
            border-color: var(--red);
            color: #fff;
        }

        .registry-lane-title {
            font-size: 1.1rem;
            font-weight: 800;
            margin: 32px 0 16px 0;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-bright);
        }

        .registry-lane-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        /* Finance Widget */
        .finance-widget {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            margin-top: 24px;
            scroll-margin-top: 80px;
            /* Account for sticky header */
        }

        .finance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .finance-title {
            font-size: 0.72rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-dim);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .growth-container {
            margin-bottom: 20px;
        }

        .growth-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            margin-bottom: 8px;
        }

        .growth-bar-bg {
            height: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .growth-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #10b981);
            border-radius: 4px;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .finance-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .finance-stat {
            background: rgba(255, 255, 255, 0.03);
            padding: 12px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
        }

        .stat-label {
            font-size: 0.6rem;
            color: var(--text-dim);
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-bright);
        }

        .time-shield {
            margin-top: 16px;
            padding: 12px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.75rem;
            color: #60a5fa;
        }

        .shield-pulse {
            width: 8px;
            height: 8px;
            background: #3b82f6;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
            }
        }

        /* ========== DOCUMENT VIEWER OVERLAY ========== */
        .viewer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.98);
            z-index: 3000;
            display: none;
            flex-direction: column;
            overflow-y: auto;
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
        }

        .viewer-header {
            position: sticky;
            top: 0;
            padding: 16px 24px;
            background: rgba(15, 15, 20, 0.8);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
        }

        .viewer-title {
            font-weight: 700;
            color: var(--gold);
            font-size: 1.1rem;
        }

        .viewer-close {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-bright);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
        }

        .viewer-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 24px;
            width: 100%;
            font-size: 1.05rem;
            line-height: 1.7;
            color: var(--text);
        }

        .viewer-content h1,
        .viewer-content h2,
        .viewer-content h3 {
            color: var(--text-bright);
            margin: 24px 0 16px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 8px;
        }

        .viewer-content p {
            margin-bottom: 16px;
        }

        .viewer-content ul {
            margin-left: 20px;
            margin-bottom: 16px;
        }

        .viewer-content code {
            background: rgba(255, 255, 255, 0.05);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }

        .viewer-content pre {
            background: rgba(255, 255, 255, 0.03);
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            border: 1px solid var(--border);
        }

        .viewer-content blockquote {
            border-left: 4px solid var(--gold);
            padding-left: 16px;
            font-style: italic;
            color: var(--text-dim);
            margin: 20px 0;
        }

        .viewer-content img {
            max-width: 100%;
            border-radius: 8px;
            margin: 20px 0;
        }

        .viewer-content a {
            color: var(--gold);
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .viewer-content {
                padding: 20px 16px;
                font-size: 1rem;
            }
        }
    </style>
</head>

<body data-theme="business">
    <!-- Status Bar -->
    <div class="status-bar">
        <div class="status-items">
            <div class="branding-logo"
                style="width:28px; height:28px; background:var(--primary); border-radius:8px; display:flex; align-items:center; justify-content:center; font-weight:800; color:#000; transition: background 0.5s;">
                CD</div>
            <span id="hub-title" style="font-weight:700; font-size:1rem; letter-spacing:-0.02em;">Clinical Development
                Agency</span>
            <div class="business-only"
                style="margin-left:12px; font-size:0.65rem; color:var(--text-dim); background:rgba(0,0,0,0.3); padding:4px 8px; border-radius:4px; border:1px solid var(--border); display:flex; align-items:center; gap:6px;">
                <span
                    style="width:6px; height:6px; background:var(--green); border-radius:50%; box-shadow: 0 0 10px var(--green);"></span>
                Governed by **Sprint Command**
            </div>
        </div>

        <div class="status-item business-only" id="global-revenue">
            <span class="status-label">Revenue Goal ($5K):</span>
            <div class="revenue-mini-bar">
                <div class="revenue-mini-fill" id="revenue-fill"></div>
            </div>
            <span class="status-value" id="revenue-current">...</span>
            <div style="display:flex;gap:16px;">
                <a href="playbook/clinical-architecture.md" class="status-link">üìã Strategy</a>
                <a href="business/docs/wnq_wix_completion_guide_2026-02-12.md" class="status-link">üó∫Ô∏è Roadmap</a>
            </div>
        </div>

        <div class="status-item business-only">
            <span class="status-label">WNQ Health:</span>
            <span class="status-value" style="color:var(--green)">100% OPERATIONAL</span>
        </div>

        <div class="status-item">
            <button onclick="app.toggleSettings()"
                style="background:none; border:none; cursor:pointer; color:var(--text-dim); font-size:1.1rem; padding: 4px; transition: color 0.2s;"
                onmouseover="this.style.color='var(--primary)'"
                onmouseout="this.style.color='var(--text-dim)'">‚öôÔ∏è</button>
        </div>
    </div>

    <div class="hud-nav">
        <button class="nav-btn active" id="btn-business" onclick="app.switchMode('business')">üè¢ Business Hub</button>
        <button class="nav-btn" id="btn-career" onclick="app.switchMode('career')">üöÄ Career Hub</button>
        <button class="nav-btn" id="btn-registry" onclick="app.switchMode('registry')">üóÑÔ∏è Registry Hub</button>
    </div>

    <div class="main">
        <!-- Left Sidebar: Progress & Pulse -->
        <div class="left-col">
            <div class="card">
                <div class="card-title"><span class="dot" style="background:var(--primary)"></span>Mode Readiness</div>
                <div id="readiness-ring"></div>
                <div id="stats-panel" style="margin-top:16px;"></div>
            </div>

            <!-- Finance Tracker -->
            <div class="finance-widget">
                <div class="finance-header">
                    <div class="finance-title">üí∞ Financial Engine</div>
                </div>

                <div class="growth-container">
                    <div class="growth-label">
                        <span>Ecosystem Growth</span>
                        <span id="growthPercent" style="color: var(--accent);">0%</span>
                    </div>
                    <div class="growth-bar-bg">
                        <div class="growth-bar-fill" id="growthBar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="finance-grid">
                    <div class="finance-stat">
                        <div class="stat-label">Proj. Gross (Monthly)</div>
                        <div class="stat-value" id="projGross">$10,400</div>
                    </div>
                    <div class="finance-stat">
                        <div class="stat-label">Clinical Rate</div>
                        <div class="stat-value">$60/hr</div>
                    </div>
                </div>

                <div class="time-shield">
                    <div class="shield-pulse"></div>
                    <div id="timeShieldStatus">Shield Active: 20:00 - 22:00</div>
                </div>
            </div>

            <div id="sidebar-contextual">
                <!-- Pipeline stages for Career, Service blocks for Business -->
            </div>
        </div>

        <!-- Center: Task Engine -->
        <div class="center-col">
            <div class="card spotlight-card">
                <div class="card-title"><span class="dot" style="background:var(--primary)"></span>Next Actions
                    Spotlight</div>
                <div id="action-list"></div>
                <div id="extra-links"
                    style="margin-top:16px; border-top:1px solid var(--border); padding-top:12px; display:none;">
                    <a id="tech-prep-link" href="career/siemens_prep.html" target="_blank"
                        style="color:var(--cyan); text-decoration:none; font-size:0.75rem; font-weight:700;">üìò Siemens
                        / PPCL Study Guide ‚Üí</a>
                </div>
            </div>

            <div id="task-sections-container">
                <!-- Rendered sections -->
            </div>
        </div>

        <!-- Right: Logs & Knowledge -->
        <div class="right-col">
            <div class="card">
                <div class="card-title"><span class="dot" style="background:var(--purple)"></span>Captain's Log</div>
                <div class="log-entries" id="log-list"></div>
                <div style="margin-top:16px; display:flex; gap:8px;">
                    <input type="text" id="log-input" class="input-field" placeholder="New entry..."
                        style="margin-bottom:0;" onkeydown="if(event.key==='Enter') app.addLog(this.value)">
                    <button onclick="app.addLog(document.getElementById('log-input').value)"
                        style="background:var(--primary); color:#000; border:none; padding:0 16px; border-radius:8px; font-weight:700; cursor:pointer;">+</button>
                </div>
            </div>

            <div style="margin-top:16px; border-top:1px solid var(--border); padding-top:12px;">
                <button onclick="app.lockHub()"
                    style="background:none; border:none; color:var(--text-dim); text-decoration:none; font-size:0.7rem; display:flex; align-items:center; gap:6px; cursor:pointer;">
                    üîí Lock Hub
                </button>
            </div>
        </div>

        <div id="sync-status" onclick="app.showSyncDetail()"
            style="font-size:0.65rem; color:var(--text-dim); text-align:right; padding:0 10px; cursor:pointer;"
            title="Click for details">
            <span id="sync-dot"
                style="display:inline-block; width:6px; height:6px; border-radius:50%; background:var(--border); margin-right:4px;"></span>
            <span id="sync-text">Local Only</span>
            <div style="margin-top:8px; opacity:0.6; font-size:0.6rem;">
                V8.8.8 Engine ‚Ä¢ Last Session: Feb 14-15
            </div>
        </div>
    </div>

    <!-- Document Viewer Overlay -->
    <div class="viewer-overlay" id="doc-viewer">
        <div class="viewer-header">
            <span class="viewer-title" id="viewer-title">Document Reader</span>
            <button class="viewer-close" onclick="app.closeReader()">Close</button>
        </div>
        <div class="viewer-content" id="viewer-content">
            <!-- Content -->
        </div>
    </div>
    </div>

    <!-- Quiz Overlay -->
    <div class="overlay" id="quiz-overlay">
        <div class="quiz-modal fade-in" id="quiz-content">
            <!-- Dynamic Quiz Content -->
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="overlay" id="settings-overlay">
        <div class="settings-modal fade-in">
            <h2>‚öôÔ∏è Hub Settings</h2>
            <label class="status-label">GitHub Gist ID</label>
            <input type="text" id="gist-id" class="input-field">
            <label class="status-label">GitHub PAT</label>
            <input type="password" id="gist-pat" class="input-field">
            <div style="margin-top:20px; border-top:1px solid var(--border); padding-top:20px;">
                <label class="status-label">üõ†Ô∏è Maintenance</label>
                <button onclick="app.clearLogs()"
                    style="background:rgba(255, 68, 68, 0.1); color:var(--red); border:1px solid var(--red); padding:10px 16px; border-radius:8px; font-weight:700; cursor:pointer; width:100%; transition:all 0.2s;"
                    onmouseover="this.style.background='var(--red)'; this.style.color='#fff';"
                    onmouseout="this.style.background='rgba(255, 68, 68, 0.1)'; this.style.color='var(--red)';">Archive
                    & Condense Session (Current Hub)</button>
            </div>
            <div style="display:flex; justify-content:flex-end; gap:12px; margin-top:20px;">
                <button onclick="app.toggleSettings()"
                    style="background:none; border:none; color:var(--text-dim); cursor:pointer;">Cancel</button>
                <button onclick="app.saveSettings()"
                    style="background:var(--primary); color:#000; border:none; padding:10px 24px; border-radius:8px; font-weight:700; cursor:pointer;">Save
                    & Sync</button>
            </div>
        </div>
    </div>

    <script>
        const TASK_DATA = {
            // BUSINESS LANE
            phase1a: {
                lane: 'business', area: "sc", title: "‚ö° Phase 1A ‚Äî Monetization Sprint", badge: "Launch Feb 27", badgeColor: "var(--gold)", tasks: [
                    { id: "p1a1", text: "Scope WNQ website as paid deliverable ($3,000 flat fee)", preChecked: true },
                    { id: "p1a0", text: "Send proposal + collect 50% upfront ($1,500) ‚Äî URGENT: Feb 15" },
                    { id: "p1a2", text: "Build WNQ site using existing pipeline" },
                    { id: "p1a6", text: "Capture proof: before/after screenshots, metrics" },
                    { id: "p1a7", text: "Soft pre-sell to board (Feb 25)" },
                    { id: "p1a3", text: "üéØ Launch WNQ website (Feb 27) + collect 50% ($1,500)" },
                    { id: "p1a4", text: "Create WNQ Case Study IMMEDIATELY on launch day" }
                ]
            },
            wnq_phase1: {
                lane: 'business', area: "wnq", title: "WNQ ‚Äî Phase 1: Foundation Polish", badge: "In Progress", badgeColor: "var(--orange)", tasks: [
                    { id: "w1", text: "Add social media icon buttons (TikTok, IG) to header/footer" },
                    { id: "w2", text: "Elevate lion mascot ‚Äî favicon, header, social avatars" },
                    { id: "w3", text: "Add brand pillars ‚Äî Strength & Community shown, add Integrity" },
                    { id: "w5", text: "SEO optimization ‚Äî title tags, meta descriptions" },
                    { id: "w6", text: "Mobile responsiveness check and fixes", preChecked: true },
                    { id: "w26", text: "Hero section ‚Äî lion mascot, headline, tagline, gold CTA", preChecked: true },
                    { id: "w32", text: "Apply gold accent (#FFB81C) to buttons and CTAs", preChecked: true }
                ]
            },
            wnq_phase2: {
                lane: 'business', area: "wnq", title: "WNQ ‚Äî Phase 2: Tribute & Scholarship", badge: "Week of Feb 17", badgeColor: "var(--red)", tasks: [
                    { id: "w9", text: "Build Coach Ike Riley Sr. Tribute page (museum feel)" },
                    { id: "w12", text: "Build Ike Riley Sr Memorial Scholarship page" },
                    { id: "w25_ref", text: "Scaffold Coach Tribute Memorial (Museum Style)" }
                ]
            },
            bn_collab: {
                lane: 'business', area: "bn", title: "Black Nexus ‚Äî Collaboration Hub", badge: "Live", badgeColor: "var(--green)", tasks: [
                    { id: "b23", text: "GitHub collaboration guide created", preChecked: true },
                    { id: "b24", text: "GitHub org created: blacknexuscda", preChecked: true },
                    { id: "b25", text: "JB Scott invited ‚Äî pending acceptance", preChecked: true },
                    { id: "b26", text: "Create first repo (brand-kit) and push files" },
                    { id: "b27", text: "Enable branch protection on main" }
                ]
            },

            // CAREER LANE
            prep_siemens: {
                lane: 'career', area: "technical", title: "üìò Siemens & PPCL Mastery", badge: "Priority", badgeColor: "var(--cyan)", tasks: [
                    { id: "ppcl1", text: "Review Siemens Insight Console Operator Guide" },
                    { id: "ppcl2", text: "Practice Conditional IF/THEN/ELSE Logic Blocks" },
                    { id: "ppcl3", text: "Audit Desigo CC Graphics & Point Mapping Protocols" },
                    { id: "ppcl4", text: "Technical Deep-Dive: BACnet/IP vs MS/TP Priority Arrays" }
                ]
            },
            prep_sterling: {
                lane: 'career', area: "interview", title: "üéØ AbbVie / Sterling Follow-Up", badge: "Post-Interview", badgeColor: "var(--cyan)", tasks: [
                    { id: "c1", text: "Sterling/Xenqu Onboarding Paperwork", preChecked: true },
                    { id: "c2", text: "Submit I-9 Documentation", preChecked: true },
                    { id: "f1_ref", text: "Review & personalize thank-you email draft" },
                    { id: "f3_ref", text: "Fill out Sterling Reference Request Form (.doc)" }
                ]
            },
            career_intel: {
                lane: 'career', area: "research", title: "üîç Career Intelligence", badge: "Dossiers", badgeColor: "var(--teal)", tasks: [
                    { id: "r1_ref", text: "LinkedIn dossier ‚Äî Gino Pisano (Technical Peer)", preChecked: true },
                    { id: "r2_ref", text: "LinkedIn dossier ‚Äî John Walters (Hiring Manager)", preChecked: true },
                    { id: "r3_ref", text: "LinkedIn dossier ‚Äî Michael Ester (Senior Authority)", preChecked: true }
                ]
            },
            surgical_scripting: {
                lane: 'career', area: "technical", title: "Surgical Scripting Lab", badge: "V8 Engine", badgeColor: "var(--cyan)", tasks: [
                    { id: "sc1", text: "The V8 Console (Interactive Guide)", preChecked: false },
                    { id: "sc2", text: "CLI Mastery: Surgical Shell Commands", preChecked: false },
                    { id: "sc3", text: "Automation: Gist-to-Hub Sync Script", preChecked: false }
                ]
            },

            // SHARED / UTILITY
            session_archival: {
                lane: 'business', area: "docs", title: "Session Archival", badge: "Feb 15", badgeColor: "var(--purple)", tasks: [
                    { id: "sa1", text: "Daily Summary: [Feb 14](business/docs/daily_summary_2026-02-14.md)", preChecked: true },
                    { id: "sa2", text: "Captain's Log: [Archive](business/docs/captains_log_2026-02-14.md)", preChecked: true }
                ]
            },
            key_documents: {
                lane: 'shared', area: "docs", title: "üìÇ Master Documents", badge: "Global", badgeColor: "var(--purple)", tasks: [
                    { id: "doc1", text: "Master Playbook [PDF](playbook/master_playbook.pdf)", preChecked: true },
                    { id: "doc2", text: "Brand Kit [PDF](business/docs/brand-kit.pdf)", preChecked: true },
                    { id: "odoc1", text: "Sterling Benefits [PDF](career/docs/2026_Benefits_Guide.pdf)", preChecked: true }
                ]
            }
        };


        const QUIZ_DATA = {
            siemens_ppcl: {
                lane: 'career',
                title: 'Siemens PPCL Syntax Diagnostic',
                questions: [
                    {
                        q: "Which command is used to set a point to a specific value in PPCL?",
                        options: ["VAL", "SET", "MOVE", "WRITE"],
                        correct: 1
                    },
                    {
                        q: "How do you define a conditional block in PPCL?",
                        options: ["IF/THEN/ELSE", "WHEN/DO", "CASE/OF", "SWITCH/CASE"],
                        correct: 0
                    },
                    {
                        q: "What does the command 'GOTO 100' do?",
                        options: ["Sets value to 100", "Jumps to line 100", "Waits for 100ms", "Stops execution"],
                        correct: 1
                    }
                ]
            },
            coding_check: {
                lane: 'career',
                title: 'CDA Surgical Scripting Check',
                questions: [
                    {
                        q: "Which protocol ensures dashboard state is synced globally?",
                        options: ["Surgical Sync", "Git Push Only", "Local Storage Only", "Manual Copy"],
                        correct: 0
                    },
                    {
                        q: "What is the primary role of the Captain's Log?",
                        options: ["Social Media Posts", "Clinical Event Streaming", "Billing Only", "Design Mockups"],
                        correct: 1
                    }
                ]
            }
        };

        const NEXT_ACTIONS = [
            // CAREER ACTIONS
            { id: "a16", text: "Sterling/Xenqu Onboarding Documentation (Checklist v1)", preChecked: true, urgency: "now", source: "Founder Briefing", lane: "career" },
            { id: "a22", text: "Final iPhone test for Deep Link highlight visibility", urgency: "now", source: "Panel Review", lane: "career" },
            { id: "a30", text: "Complete Siemens Platform Deep-Dive (Insight/Desigo)", urgency: "now", source: "Career Hub", lane: "career" },
            { id: "a31", text: "Review Technical Talking Points for Siemens Peer Interview", urgency: "soon", source: "Career Hub", lane: "career" },

            // BUSINESS ACTIONS
            { id: "a20", text: "WNQ Proposal (Drafted - Ready for Ike) + Collect 50% Upfront ($1,500)", urgency: "now", source: "Phase 1A Sprint", lane: "business" },
            { id: "a21", text: "Link Clinical OS protocol to Black Nexus onboarding track", preChecked: true, urgency: "now", source: "Panel Review", lane: "business" },
            { id: "a23", text: "Extract inline Hub CSS to hub-core.css", urgency: "soon", source: "Refactor", lane: "business" },
            { id: "a32", text: "Audit 'antigravity/workflows' for manual vs auto drift", urgency: "now", source: "Morning Brief", lane: "business" },
            { id: "a33", text: "Process raw foundation files into system refinements", urgency: "now", source: "Morning Brief", lane: "business" }
        ];

        class MasterApp {
            constructor() {
                this.state = { business: {}, career: {}, registry: {} };
                this.registryData = {};
                this.setupIntercept();
                this.init();
            }

            resolveDocPath(rawPath, isPdf = false) {
                if (!rawPath || rawPath === '#') return '#';

                // Strip landing folder if present (e.g. Advisory Panel/...)
                let filename = rawPath.split('/').pop();
                let pathLower = rawPath.toLowerCase();

                // 1. Career Documents
                if (pathLower.includes('career/docs/')) {
                    return `career/docs/${filename}${isPdf && !filename.endsWith('.pdf') ? '.pdf' : ''}`;
                }

                // 2. Playbook / Governance
                if (pathLower.includes('playbook/')) {
                    return `playbook/${filename}${isPdf && !filename.endsWith('.pdf') ? '.pdf' : ''}`;
                }

                // 3. Resources (PDF ONLY)
                if (pathLower.includes('resources/') && isPdf) {
                    return `business/docs/resources/${filename}${!filename.endsWith('.pdf') ? '.pdf' : ''}`;
                }

                // 4. Default Business Docs (Black Nexus, WNQ, Advisory Panel)
                return `business/docs/${filename}${isPdf && !filename.endsWith('.pdf') ? '.pdf' : ''}`;
            }

            parseLinks(text) {
                if (!text) return '';
                // Simple markdown link parser [label](url)
                return text.replace(/\[([^\]]+)\]\(([^)]+)\)/g, (match, label, url) => {
                    return `<a href="${url}">${label}</a>`;
                });
            }

            setupIntercept() {
                document.addEventListener('click', (e) => {
                    const link = e.target.closest('a');
                    if (!link) return;

                    let href = link.getAttribute('href');
                    if (href && href.endsWith('.md') && !href.startsWith('http')) {
                        e.preventDefault();

                        // Handle potential hardcoded local paths by resolving them
                        if (href.includes('/') || href.includes('\\')) {
                            href = this.resolveDocPath(href, false);
                        }

                        const title = link.innerText || "Document";
                        this.openReader(href, title);
                    }
                });
            }

            async init() {
                if (!this.checkAuthentication()) return;
                this.loadLocal();

                // Fetch dynamic registry data
                await this.loadRegistryData();
                this.updateFinance();

                const hash = window.location.hash.substring(1);
                if (hash === 'career') this.switchMode('career');
                else this.switchMode('business');

                await this.syncFromGist();
                this.render();
            }

            loadLocal() {
                const saved = localStorage.getItem('master_hub_state');
                if (saved) this.state = JSON.parse(saved);
            }

            saveLocal() {
                localStorage.setItem('master_hub_state', JSON.stringify(this.state));
                this.debouncedSync();
            }

            switchMode(mode) {
                this.mode = mode;
                document.body.setAttribute('data-theme', mode === 'registry' ? 'business' : mode);
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById(`btn-${mode}`).classList.add('active');

                // Toggle lane-specific status elements
                document.querySelectorAll('.business-only').forEach(el => el.style.display = (mode === 'business' || mode === 'registry') ? 'flex' : 'none');

                // Initialize state if switching to a mode for the first time
                if (!this.state[mode]) {
                    this.state[mode] = { tasks: {}, logs: [], completedActions: {}, collapsed: {} };
                }

                this.render();
                window.location.hash = mode;

                this.render();
            }

            debouncedSync() {
                if (this.syncTimer) clearTimeout(this.syncTimer);
                this.syncTimer = setTimeout(() => this.syncToGist(), 3000);
            }

            async syncToGist() {
                const cfg = this.getGistConfig();
                if (!cfg || !cfg.pat || !cfg.gistId) {
                    this.setSyncStatus('config_needed');
                    return;
                }
                this.setSyncStatus('syncing');
                try {
                    const filename = this.mode === 'business' ? 'sc_dashboard_state.json' : 'ch_dashboard_state.json';
                    const res = await fetch(`https://api.github.com/gists/${cfg.gistId}`, {
                        method: 'PATCH',
                        headers: { 'Authorization': `Bearer ${cfg.pat}`, 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            files: {
                                [filename]: {
                                    content: JSON.stringify(this.sanitizePayload(this.state[this.mode]), null, 2)
                                }
                            }
                        })
                    });
                    if (res.ok) {
                        this.setSyncStatus('synced');
                    } else {
                        throw new Error(`HTTP ${res.status}`);
                    }
                } catch (e) {
                    console.error("Gist Push Error:", e);
                    this.setSyncStatus('error', e.message);
                }
            }

            async syncFromGist() {
                const cfg = this.getGistConfig();
                if (!cfg || !cfg.pat || !cfg.gistId) {
                    this.setSyncStatus('config_needed');
                    return;
                }
                this.setSyncStatus('syncing');
                try {
                    const res = await fetch(`https://api.github.com/gists/${cfg.gistId}`, {
                        headers: { 'Authorization': `Bearer ${cfg.pat}` }
                    });
                    if (res.status === 401) throw new Error('Unauthorized (Check PAT)');
                    if (res.status === 404) throw new Error('Gist Not Found');
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);

                    const gist = await res.json();
                    ['business', 'career'].forEach(lane => {
                        const file = gist.files[lane === 'business' ? 'sc_dashboard_state.json' : 'ch_dashboard_state.json'];
                        if (file && file.content) this.state[lane] = JSON.parse(file.content);
                    });
                    this.setSyncStatus('synced');
                    this.render();
                } catch (e) {
                    console.error("Gist Sync Error:", e);
                    this.setSyncStatus('error', e.message);
                }
            }

            sanitizePayload(data) {
                const json = JSON.stringify(data);
                // Regex to catch GitHub PATs and block them from syncing
                const sanitized = json.replace(/ghp_[a-zA-Z0-9]{36}/g, "[REDACTED_SECRET]");
                if (json !== sanitized) {
                    console.warn("Security Layer: Secret detected and redacted from sync payload.");
                    this.addLog("‚ö†Ô∏è Security: Leak prevented during sync.");
                }
                return JSON.parse(sanitized);
            }

            getGistConfig() {
                const saved = localStorage.getItem('sc_gist_config');
                return saved ? JSON.parse(saved) : null;
            }

            setSyncStatus(status, detail = '') {
                const dot = document.getElementById('sync-dot');
                const txt = document.getElementById('sync-text');
                if (!dot || !txt) return;

                this.lastSyncError = detail;

                if (status === 'synced') {
                    dot.style.background = 'var(--green)';
                    txt.innerText = 'Synced';
                } else if (status === 'syncing') {
                    dot.style.background = 'var(--orange)';
                    txt.innerText = 'Syncing...';
                } else if (status === 'config_needed') {
                    dot.style.background = 'var(--text-dim)';
                    txt.innerText = 'Config Needed';
                } else if (status === 'error') {
                    dot.style.background = 'var(--red)';
                    txt.innerText = 'Sync Error';
                }
            }

            showSyncDetail() {
                if (this.lastSyncError) {
                    alert(`Sync Detail: ${this.lastSyncError}`);
                } else {
                    const cfg = this.getGistConfig();
                    if (!cfg || !cfg.pat) alert("Status: Configuration Needed. Open settings to set PAT/Gist ID.");
                    else alert("Status: Local Only. No errors recorded.");
                }
            }

            async openReader(url, title = "Document") {
                const overlay = document.getElementById('doc-viewer');
                const content = document.getElementById('viewer-content');
                const titleEl = document.getElementById('viewer-title');

                if (!overlay || !content) return;

                overlay.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                titleEl.innerText = title;
                content.innerHTML = '<div style="text-align:center; padding:40px;">‚åõ Loading engine...</div>';

                try {
                    const res = await fetch(url);
                    if (!res.ok) throw new Error(`Fetch failed: ${res.status}`);
                    const raw = await res.text();
                    content.innerHTML = this.parseMarkdown(raw);
                    overlay.scrollTop = 0;
                } catch (e) {
                    content.innerHTML = `<div style="color:var(--red); padding:40px; border:1px solid var(--red); border-radius:8px; background:rgba(255,255,255,0.03);">
                        <h3>Read Failure</h3>
                        <p>${e.message}</p>
                        <p style="margin-top:20px; font-size:0.8rem; opacity:0.6;">Path: ${url}</p>
                    </div>`;
                }
            }

            closeReader() {
                document.getElementById('doc-viewer').style.display = 'none';
                document.body.style.overflow = 'auto';
            }

            parseMarkdown(text) {
                // Ported regex parser from guides.html for zero-dependency speed
                let html = text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');

                // Bold/Italic
                html = html.replace(/\*\*\*(.*?)\*\*\*/g, '<strong><em>$1</em></strong>');
                html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');

                // Headings
                html = html.replace(/^# (.*)$/gm, '<h1>$1</h1>');
                html = html.replace(/^## (.*)$/gm, '<h2>$1</h2>');
                html = html.replace(/^### (.*)$/gm, '<h3>$1</h3>');

                // Links/Deep Links
                html = html.replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>');

                // Code
                html = html.replace(/`(.*?)`/g, '<code>$1</code>');
                html = html.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>');

                // Checkboxes
                html = html.replace(/- \[x\] (.+)/g, '<li><input type="checkbox" checked disabled> $1</li>');
                html = html.replace(/- \[ \] (.+)/g, '<li><input type="checkbox" disabled> $1</li>');

                // Lists
                html = html.replace(/^- (.+)$/gm, '<li>$1</li>');
                html = html.replace(/^\d+\. (.+)$/gm, '<li>$1</li>');
                html = html.replace(/((<li>.*<\/li>\n?)+)/g, '<ul>$1</ul>');

                // Paragraphs
                html = html.replace(/^(?!<[a-z]|$)(.+)$/gm, '<p>$1</p>');
                html = html.replace(/<p>\s*<\/p>/g, '');

                return html;
            }

            async loadRegistryData() {
                try {
                    const res = await fetch('registry_data.json');
                    if (res.ok) {
                        this.registryData = await res.json();
                        console.log("Registry Sync: Dynamic data loaded.");
                    }
                } catch (e) {
                    console.error("Registry Sync: Failed to load dynamic data.", e);
                }
            }

            updateFinance() {
                // Baseline: Sterling $60/hr * 40hrs * 4.33 weeks = ~$10,400
                const careerGross = 10400;
                // Currently assume business revenue is starting at $2000 (Phase 1 Target)
                const businessRevenue = 2000;
                const totalEcosystem = careerGross + businessRevenue;
                const growthFactor = (businessRevenue / careerGross) * 100;

                const growthBar = document.getElementById('growthBar');
                const growthPct = document.getElementById('growthPercent');
                const projGross = document.getElementById('projGross');

                if (growthBar) growthBar.style.width = `${Math.min(growthFactor, 100)}%`;
                if (growthPct) growthPct.innerText = `${growthFactor.toFixed(1)}%`;
                if (projGross) projGross.innerText = `$${totalEcosystem.toLocaleString()}`;

                // Calculate Shield Status
                const now = new Date();
                const hour = now.getHours();
                const statusEl = document.getElementById('timeShieldStatus');

                if (statusEl) {
                    if (hour >= 20 && hour <= 22) {
                        statusEl.innerText = "Shield Active: Deep Work Mode";
                        statusEl.parentElement.style.background = "rgba(59, 130, 246, 0.15)";
                        statusEl.parentElement.style.borderColor = "#3b82f6";
                    } else {
                        statusEl.innerText = "Shield Standby: Sterling Hours";
                        statusEl.parentElement.style.background = "rgba(16, 185, 129, 0.1)";
                        statusEl.parentElement.style.borderColor = "rgba(16, 185, 129, 0.2)";
                        statusEl.previousElementSibling.style.background = "#10b981"; // pulse
                    }
                }
            }

            getTaskState(id) {
                if (this.state[this.mode] && this.state[this.mode].tasks && this.state[this.mode].tasks[id]) return this.state[this.mode].tasks[id];
                // Check preChecked
                for (const s of Object.values(TASK_DATA)) {
                    const t = s.tasks.find(x => x.id === id);
                    if (t && t.preChecked) return 'done';
                }
                return 'todo';
            }

            cycleTask(id) {
                const current = this.getTaskState(id);
                const next = current === 'todo' ? 'progress' : current === 'progress' ? 'done' : 'todo';
                this.state[this.mode].tasks[id] = next;
                this.saveLocal();
                this.render();
            }

            addLog(text) {
                if (!text.trim()) return;
                const now = new Date();
                const time = now.toLocaleDateString() + ' ' + now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                if (!this.state[this.mode].logs) this.state[this.mode].logs = [];
                this.state[this.mode].logs.unshift({ text: text.trim(), time });
                document.getElementById('log-input').value = '';
                this.saveLocal();
                this.render();
            }

            clearLogs() {
                if (confirm(`‚ö†Ô∏è Are you sure you want to Archive & Condense all logs for the ${this.mode} hub? This purges the dashboard feed; ensure your extraction is complete first.`)) {
                    this.state[this.mode].logs = [];
                    this.addLog(`üßπ ${this.mode.charAt(0).toUpperCase() + this.mode.slice(1)} Session Archived & Condensed.`);
                    this.saveLocal();
                    this.render();
                }
            }

            toggleAction(id) {
                this.state[this.mode].completedActions[id] = !this.state[this.mode].completedActions[id];
                this.saveLocal();
                this.render();
            }

            toggleSettings() { document.getElementById('settings-overlay').classList.toggle('open'); }

            saveSettings() {
                const id = document.getElementById('gist-id').value;
                const pat = document.getElementById('gist-pat').value;
                localStorage.setItem('sc_gist_config', JSON.stringify({ gistId: id, pat: pat }));
                this.toggleSettings();
                this.syncFromGist();
            }

            startQuiz(id) {
                this.currentQuiz = { id, step: 0, score: 0 };
                document.getElementById('quiz-overlay').classList.add('open');
                this.renderQuiz();
            }

            renderQuiz() {
                const qd = QUIZ_DATA[this.currentQuiz.id];
                const step = qd.questions[this.currentQuiz.step];
                const container = document.getElementById('quiz-content');

                if (this.currentQuiz.step < qd.questions.length) {
                    container.innerHTML = `
                        <h3 style="margin-bottom:12px;color:var(--gold)">${qd.title}</h3>
                        <div class="status-label" style="margin-bottom:20px">Question ${this.currentQuiz.step + 1} of ${qd.questions.length}</div>
                        <p style="margin-bottom:24px;font-weight:600">${step.q}</p>
                        ${step.options.map((opt, i) => `
                            <div class="quiz-option" onclick="app.submitAnswer(${i})">${opt}</div>
                        `).join('')}
                    `;
                } else {
                    const final = Math.round((this.currentQuiz.score / qd.questions.length) * 100);
                    container.innerHTML = `
                        <h3 style="margin-bottom:12px;color:var(--green)">Diagnostic Complete</h3>
                        <div style="font-size:3rem;font-weight:800;margin:20px 0">${final}%</div>
                        <p style="margin-bottom:24px;color:var(--text-dim)">Knowledge verification saved to session log.</p>
                        <button onclick="app.closeQuiz()" style="background:var(--primary);color:#000;border:none;padding:12px 24px;border-radius:8px;font-weight:700;cursor:pointer;width:100%">Close Diagnostic</button>
                    `;
                    this.addLog(`Completed ${qd.title}: Score ${final}%`);
                }
            }

            submitAnswer(idx) {
                const qd = QUIZ_DATA[this.currentQuiz.id];
                if (idx === qd.questions[this.currentQuiz.step].correct) this.currentQuiz.score++;
                this.currentQuiz.step++;
                this.renderQuiz();
            }

            closeQuiz() {
                document.getElementById('quiz-overlay').classList.remove('open');
                this.currentQuiz = null;
            }

            copyDeepLink(sectionId) {
                const url = new URL(window.location);
                url.hash = `${this.mode}:${sectionId}`;
                navigator.clipboard.writeText(url.href);
                this.addLog(`Deep link copied: ${sectionId}`);
            }

            handleDeepLink() {
                const fullHash = window.location.hash.substring(1);
                if (!fullHash) return;

                // Allow both mode:section and just mode
                const [targetMode, sectionId] = fullHash.includes(':') ? fullHash.split(':') : [fullHash, null];

                if (targetMode === 'career' || targetMode === 'business') {
                    if (this.mode !== targetMode) {
                        this.switchMode(targetMode);
                    }
                }

                if (sectionId) {
                    // Give the DOM a moment to re-render if we switched modes
                    setTimeout(() => {
                        const el = document.getElementById(sectionId);
                        if (el) {
                            el.scrollIntoView({ behavior: 'smooth', block: 'start' });
                            el.classList.add('section-highlight');
                            setTimeout(() => el.classList.remove('section-highlight'), 3000);
                        }
                    }, 300);
                }
            }

            lockHub() {
                localStorage.removeItem('sc_hub_authenticated');
                location.reload();
            }

            checkAuthentication() {
                const authenticated = localStorage.getItem('sc_hub_authenticated');
                const cfg = this.getGistConfig();

                // CORTEX BYPASS: Allow local access or debug hash
                const isLocal = window.location.protocol === 'file:';
                const isBypass = window.location.hash.includes('cortex:bypass');
                if (isLocal || isBypass) return true;

                // If no PAT/Gist configured, let them in to set it up
                if (!cfg || !cfg.pat) return true;

                if (!authenticated) {
                    const pass = prompt('Enter Hub Passcode:');
                    if (pass === cfg.pat.substring(0, 4)) {
                        localStorage.setItem('sc_hub_authenticated', 'true');
                        return true;
                    } else {
                        document.body.innerHTML = `<div style="height:100vh; display:flex; align-items:center; justify-content:center; flex-direction:column; color:var(--text-dim); font-family:sans-serif;">
                            <h1 style="color:var(--red)">Access Denied</h1>
                            <p>Invalid Passcode. (Hint: First 4 chars of PAT)</p>
                            <button onclick="location.reload()" style="margin-top:20px; background:var(--gold); color:#000; border:none; padding:10px 20px; border-radius:8px; cursor:pointer; font-weight:700;">Retry</button>
                        </div>`;
                        return false;
                    }
                }
                return true;
            }

            render() {
                const laneTasks = Object.values(TASK_DATA).filter(s => s.lane === this.mode || s.lane === 'shared');
                const allLaneTasks = laneTasks.flatMap(s => s.tasks);
                const done = allLaneTasks.filter(t => this.getTaskState(t.id) === 'done').length;
                const pct = allLaneTasks.length ? Math.round((done / allLaneTasks.length) * 100) : 0;

                // Rings
                const circ = 2 * Math.PI * 62;
                const offset = circ - (pct / 100) * circ;
                document.getElementById('readiness-ring').innerHTML = `
          <div class="big-ring-wrap">
            <div class="big-ring">
              <svg viewBox="0 0 140 140">
                <circle class="bg" cx="70" cy="70" r="62"/>
                <circle class="fill" cx="70" cy="70" r="62" stroke="var(--primary)" stroke-dasharray="${circ}" stroke-dashoffset="${offset}"/>
              </svg>
              <div class="big-ring-pct"><div class="num">${pct}%</div><div class="label">${this.mode === 'business' ? 'Consulting Ready' : 'Interview Ready'}</div></div>
            </div>
          </div>`;

                // Stats
                document.getElementById('stats-panel').innerHTML = `
          <div class="stat-row"><span class="status-label">Total Workload</span><span class="status-value">${allLaneTasks.length} units</span></div>
          <div class="stat-row"><span class="status-label">Shipped</span><span class="status-value" style="color:var(--green)">${done}</span></div>
        `;

                // Sidebar Contextual
                const sideCtx = document.getElementById('sidebar-contextual');
                const diagList = Object.entries(QUIZ_DATA).filter(([id, q]) => q.lane === this.mode);
                if (diagList.length) {
                    sideCtx.innerHTML = `
                        <div class="card fade-in" style="margin-top:16px;">
                            <div class="status-label">Diagnostic Tools</div>
                            <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;">
                                ${diagList.map(([id, q]) => `
                                    <div class="diag-badge" onclick="app.startQuiz('${id}')">
                                        ‚ö° ${q.title}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                } else {
                    sideCtx.innerHTML = '';
                }

                // Revenue Spotlight (Only in Business)
                const rev = 400;
                const revenuePanel = document.getElementById('global-revenue');
                if (revenuePanel) {
                    document.getElementById('revenue-current').innerText = `$${rev.toLocaleString()}`;
                    document.getElementById('revenue-fill').style.width = `${(rev / 5000) * 100}%`;
                }

                // Actions
                const actions = NEXT_ACTIONS.filter(a => a.lane === this.mode);
                document.getElementById('action-list').innerHTML = actions.map(a => {
                    const isDone = this.state[this.mode].completedActions && this.state[this.mode].completedActions[a.id];
                    return `
                        <div class="action-item ${isDone ? 'completed' : ''}" onclick="app.toggleAction('${a.id}')">
                            <div class="action-check"></div>
                            <div>
                                <div class="task-text" style="font-size:0.8rem;">${a.text}</div>
                                <div class="status-label" style="font-size:0.6rem;">${a.source}</div>
                            </div>
                        </div>
                    `;
                }).join('');

                const extraLinks = document.getElementById('extra-links');
                if (extraLinks) extraLinks.style.display = this.mode === 'career' ? 'block' : 'none';

                // Sections
                if (this.mode === 'registry') {
                    this.renderRegistry();
                } else {
                    document.getElementById('task-sections-container').innerHTML = `
                        <div id="${this.mode}-portal" class="hub-container">
                            ${laneTasks.map(s => {
                        const sDone = s.tasks.filter(t => this.getTaskState(t.id) === 'done').length;
                        // Find the key in TASK_DATA for this section to use as ID
                        const sectionKey = Object.keys(TASK_DATA).find(key => TASK_DATA[key] === s);
                        return `
                                    <div class="card fade-in" id="${sectionKey}">
                                      <div class="task-section-header">
                                        <div class="section-title">
                                          ${s.title}
                                          <span class="section-badge" style="background:${s.badgeColor}20;color:${s.badgeColor}">${s.badge}</span>
                                          <span class="deeplink-btn" title="Copy Deep Link" onclick="app.copyDeepLink('${sectionKey}')">üîó</span>
                                        </div>
                                        <div class="status-label">${sDone}/${s.tasks.length}</div>
                                      </div>
                                      <div class="task-list">
                                        ${s.tasks.map(t => `
                                          <div class="task-item" data-status="${this.getTaskState(t.id)}">
                                            <div class="task-check" data-state="${this.getTaskState(t.id)}" onclick="app.cycleTask('${t.id}')"></div>
                                            <div class="task-text">${this.parseLinks(t.text)}</div>
                                          </div>
                                        `).join('')}
                                      </div>
                                    </div>
                                  `;
                    }).join('')}
                        </div>
                    `;
                }

                // Logs
                const currentLogs = (this.state[this.mode] && this.state[this.mode].logs) ? this.state[this.mode].logs : (this.state['business'] ? this.state['business'].logs : []);
                document.getElementById('log-list').innerHTML = currentLogs.map(l => `
          <div class="log-entry">
            <div class="log-time">${l.time}</div>
            <div class="log-text">${l.text}</div>
          </div>
        `).join('');
            }

            renderRegistry() {
                const container = document.getElementById('task-sections-container');
                let html = '<div class="hub-container fade-in">';

                Object.entries(this.registryData).forEach(([key, cat]) => {
                    const isVisible = cat.lanes.includes(this.mode) || cat.lanes.includes('shared');
                    if (!isVisible) return;

                    html += `
                        <div class="registry-lane">
                            <div class="registry-lane-title">${cat.icon} ${cat.title}</div>
                            <div class="registry-grid">
                                ${cat.docs.map(doc => {
                        const mdPath = doc.isOnlyPdf ? '#' : this.resolveDocPath(doc.path, false);
                        const pdfPath = this.resolveDocPath(doc.path, true);

                        return `
                                        <div class="registry-item">
                                            <div class="registry-info">
                                                <div class="registry-name">${doc.name}</div>
                                                <div class="registry-meta">${doc.path.split('/').pop().split('.').shift()}</div>
                                            </div>
                                            <div class="registry-actions">
                                                ${!doc.isOnlyPdf ? `<a href="${mdPath}" class="action-icon" title="View Markdown" onclick="app.openReader('${mdPath}', '${doc.name}'); return false;">üìù</a>` : ''}
                                                ${doc.pdf ? `<a id="pdf-${key}" href="${pdfPath}" class="action-icon pdf" title="View PDF">üìï</a>` : ''}
                                            </div>
                                        </div>
                                    `;
                    }).join('')}
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                container.innerHTML = html;
            }
        }

        const app = new MasterApp();

        window.addEventListener('load', () => {
            app.render();
            app.handleDeepLink();
        });
        window.addEventListener('hashchange', () => app.handleDeepLink());
    </script>
</body>

</html>