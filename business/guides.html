<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Concierge ‚Äî Documents</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --bg: #0a0a0f;
            --bg-card: rgba(255, 255, 255, 0.04);
            --bg-card-hover: rgba(255, 255, 255, 0.07);
            --border: rgba(255, 255, 255, 0.08);
            --text: #e4e4e7;
            --text-dim: #71717a;
            --text-bright: #fafafa;
            --gold: #FFB81C;
            --gold-dim: rgba(255, 184, 28, 0.15);
            --blue: #3b82f6;
            --blue-dim: rgba(59, 130, 246, 0.15);
            --green: #4ade80;
            --green-dim: rgba(74, 222, 128, 0.15);
            --orange: #f59e0b;
            --orange-dim: rgba(245, 158, 11, 0.15);
            --purple: #a78bfa;
            --purple-dim: rgba(167, 139, 250, 0.15);
            --red: #ef4444;
            --red-dim: rgba(239, 68, 68, 0.15);
            --radius: 16px;
            --radius-sm: 10px;
        }

        html {
            font-size: 14px;
            overflow-x: hidden;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at 20% 20%, rgba(255, 184, 28, 0.03) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(59, 130, 246, 0.03) 0%, transparent 50%);
            z-index: -1;
            pointer-events: none;
        }

        /* ========== HEADER ========== */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(10, 10, 15, 0.85);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 12px 24px;
        }

        .header-inner {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            flex-wrap: wrap;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-bright);
            letter-spacing: -0.02em;
            text-decoration: none;
        }

        .brand-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--gold), #e6a000);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #000;
            font-weight: 800;
        }

        .nav-links {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .nav-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-dim);
            font-size: 0.78rem;
            font-weight: 500;
            text-decoration: none;
            transition: all 0.2s;
        }

        .nav-link:hover,
        .nav-link.active {
            background: var(--bg-card-hover);
            color: var(--text);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .nav-link.active {
            border-color: var(--gold);
            color: var(--gold);
        }

        /* ========== MAIN LAYOUT ========== */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 24px;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }

        /* ========== SIDEBAR ========== */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .doc-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 16px;
            cursor: pointer;
            -webkit-user-select: none;
            user-select: none;
            transition: background 0.15s;
        }

        .section-header:hover {
            background: var(--bg-card-hover);
        }

        .section-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.82rem;
            font-weight: 700;
            color: var(--text-bright);
        }

        .section-icon {
            font-size: 1rem;
        }

        .section-count {
            font-size: 0.65rem;
            font-weight: 600;
            padding: 2px 7px;
            border-radius: 10px;
            background: var(--gold-dim);
            color: var(--gold);
        }

        .section-chevron {
            transition: transform 0.3s;
            color: var(--text-dim);
            font-size: 0.75rem;
        }

        .section-header.collapsed .section-chevron {
            transform: rotate(-90deg);
        }

        .doc-list {
            overflow: hidden;
            transition: max-height 0.4s ease, opacity 0.3s;
            border-top: 1px solid var(--border);
        }

        .doc-list.collapsed {
            max-height: 0 !important;
            opacity: 0;
            border-top: none;
        }

        .doc-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            cursor: pointer;
            transition: background 0.15s;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            text-decoration: none;
            color: var(--text);
        }

        .doc-item:last-child {
            border-bottom: none;
        }

        .doc-item:hover,
        .doc-item.active {
            background: var(--bg-card-hover);
        }

        .doc-item.active {
            border-left: 3px solid var(--gold);
            padding-left: 13px;
        }

        .doc-icon {
            font-size: 1rem;
            min-width: 20px;
            text-align: center;
        }

        .doc-info {
            flex: 1;
            min-width: 0;
        }

        .doc-name {
            font-size: 0.82rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .doc-meta {
            font-size: 0.65rem;
            color: var(--text-dim);
            margin-top: 1px;
        }

        .doc-badge {
            font-size: 0.6rem;
            font-weight: 600;
            padding: 1px 6px;
            border-radius: 6px;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            white-space: nowrap;
        }

        .badge-md {
            background: var(--blue-dim);
            color: var(--blue);
        }

        .badge-pdf {
            background: var(--red-dim);
            color: var(--red);
        }

        /* ========== VIEWER ========== */
        .viewer {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            display: flex;
            flex-direction: column;
            min-height: 70vh;
        }

        .viewer-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 20px;
            border-bottom: 1px solid var(--border);
            gap: 12px;
        }

        .viewer-title {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-bright);
            flex: 1;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .viewer-actions {
            display: flex;
            gap: 6px;
        }

        .viewer-btn {
            padding: 5px 10px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-dim);
            font-size: 0.72rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .viewer-btn:hover {
            background: var(--bg-card-hover);
            color: var(--text);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .viewer-btn.copied {
            border-color: var(--green);
            color: var(--green);
        }

        .viewer-body {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            line-height: 1.7;
        }

        .viewer-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            gap: 12px;
            color: var(--text-dim);
        }

        .viewer-empty-icon {
            font-size: 3rem;
            opacity: 0.3;
        }

        .viewer-empty-text {
            font-size: 0.9rem;
        }

        .viewer-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-dim);
            font-size: 0.85rem;
        }

        .viewer-loading::after {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-top-color: var(--gold);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* markdown rendered content */
        .md-content h1 {
            font-size: 1.6rem;
            font-weight: 800;
            color: var(--text-bright);
            margin-bottom: 16px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .md-content h2 {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-bright);
            margin-top: 28px;
            margin-bottom: 12px;
        }

        .md-content h3 {
            font-size: 1rem;
            font-weight: 700;
            color: var(--gold);
            margin-top: 20px;
            margin-bottom: 8px;
        }

        .md-content p {
            margin-bottom: 12px;
            color: var(--text);
        }

        .md-content ul,
        .md-content ol {
            margin-bottom: 12px;
            padding-left: 24px;
        }

        .md-content li {
            margin-bottom: 4px;
        }

        .md-content strong {
            color: var(--text-bright);
            font-weight: 700;
        }

        .md-content em {
            color: var(--gold);
            font-style: italic;
        }

        .md-content blockquote {
            border-left: 3px solid var(--gold);
            padding: 10px 16px;
            margin: 12px 0;
            background: var(--gold-dim);
            border-radius: 0 8px 8px 0;
            color: var(--text);
            font-size: 0.9rem;
        }

        .md-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            font-size: 0.85rem;
        }

        .md-content th {
            text-align: left;
            padding: 8px 12px;
            border-bottom: 2px solid var(--border);
            color: var(--text-bright);
            font-weight: 700;
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        .md-content td {
            padding: 8px 12px;
            border-bottom: 1px solid var(--border);
        }

        .md-content tr:hover {
            background: var(--bg-card-hover);
        }

        .md-content code {
            background: rgba(255, 255, 255, 0.06);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'SF Mono', monospace;
            font-size: 0.85em;
            color: var(--gold);
        }

        .md-content pre {
            background: rgba(0, 0, 0, 0.4);
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 12px 0;
            border: 1px solid var(--border);
        }

        .md-content pre code {
            background: none;
            padding: 0;
            color: var(--text);
        }

        .md-content hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 24px 0;
        }

        .md-content input[type="checkbox"] {
            margin-right: 6px;
            accent-color: var(--gold);
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .sidebar {
                order: -1;
            }
        }

        @media (max-width: 600px) {
            html {
                font-size: 13px;
            }

            .header {
                padding: 8px 12px;
            }

            .nav-links {
                display: none;
            }

            .mobile-nav-toggle {
                display: inline-flex;
            }

            .main-content {
                padding: 12px;
                gap: 12px;
            }

            .viewer-body {
                padding: 16px;
            }

            .md-content h1 {
                font-size: 1.3rem;
            }

            .md-content h2 {
                font-size: 1.05rem;
            }

            .md-content table {
                font-size: 0.78rem;
            }

            .md-content th,
            .md-content td {
                padding: 6px 8px;
            }
        }

        @media (max-width: 380px) {
            html {
                font-size: 12px;
            }

            .main-content {
                padding: 8px;
            }

            .brand span {
                display: none;
            }
        }

        .mobile-nav-toggle {
            display: none;
            align-items: center;
            justify-content: center;
            padding: 6px 10px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-dim);
            font-size: 1.1rem;
            cursor: pointer;
        }

        /* Search */
        .search-wrap {
            padding: 0 12px 12px;
        }

        .search-input {
            width: 100%;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 0.82rem;
            font-family: inherit;
            outline: none;
            transition: border-color 0.2s;
        }

        .search-input:focus {
            border-color: var(--gold);
        }

        .search-input::placeholder {
            color: var(--text-dim);
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="header-inner">
            <a class="brand" href="./">
                <div class="brand-icon">SC</div>
                <span>Documents</span>
            </a>
            <div class="nav-links">
                <a class="nav-link" href="index.html">üìä dashboard</a>
                <a class="nav-link active" href="guides.html">üìö documents</a>
                <a class="nav-link" href="../index.html">üè† Hub</a>
            </div>
            <button class="mobile-nav-toggle"
                onclick="document.querySelector('.nav-links').style.display=this.dataset.open?'none':'flex';this.dataset.open=this.dataset.open?'':'1'">‚ò∞</button>
        </div>
    </header>

    <div class="main-content">
        <!-- SIDEBAR -->
        <aside class="sidebar" id="docSidebar"></aside>

        <!-- VIEWER -->
        <div class="viewer" id="viewer">
            <div class="viewer-header">
                <div class="viewer-title" id="viewerTitle">Select a document</div>
                <div class="viewer-actions" id="viewerActions" style="display:none;">
                    <button class="viewer-btn" onclick="copyDocContent()" id="copyBtn">üìã Copy</button>
                    <button class="viewer-btn" onclick="openRawLink()">üîó Open Raw</button>
                </div>
            </div>
            <div class="viewer-body" id="viewerBody">
                <div class="viewer-empty">
                    <div class="viewer-empty-icon">üìÇ</div>
                    <div class="viewer-empty-text">Select a document from the sidebar to view</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== DOCUMENT REGISTRY ====================
        const DOCS = [
            {
                section: "üìã proposals & Offers",
                color: "var(--gold)",
                docs: [
                    { name: "wnq Website Revamp Proposal", file: "docs/wnq_website_revamp_proposal.md", type: "md", meta: "Feb 2026 ¬∑ $3,000" },
                    { name: "wnq Proposal Email Draft", file: "docs/email_wnq_proposal_feb2026.md", type: "md", meta: "Send to Ike ¬∑ Delivery checklist" },
                    { name: "Nonprofit Digital Revamp One-Pager", file: "docs/nonprofit_digital_revamp_onepager.md", type: "md", meta: "Productized offer ¬∑ $3,500" },
                    { name: "CDA wnq Case Study (Draft)", file: "docs/wnq_cda_case_study_template.md", type: "md", meta: "ROI & Metrics Template" },
                ]
            },
            {
                section: "üß† strategy & Architecture",
                color: "var(--blue)",
                docs: [
                    { name: "silas_vance Money Shot Report", file: "docs/silas_vance_money_shot_report.md", type: "md", meta: "High-leverage clinical audit" },
                ]
            },
            {
                section: "üìñ playbook (CDA Standard)",
                color: "var(--purple)",
                docs: [
                    { name: "Playbook README", file: "../playbook/readme.md", type: "md", meta: "Index & Rules" },
                    { name: "01 ‚Äî Workspace Layout", file: "../playbook/01_workspace.md", type: "md", meta: "Structure & Setup" },
                    { name: "02 ‚Äî Dashboards & Sync", file: "../playbook/02_dashboards.md", type: "md", meta: "Command Center Ops" },
                    { name: "03 ‚Äî Workflows & Commands", file: "../playbook/03_workflows.md", type: "md", meta: "Surgical Automation" },
                    { name: "04 ‚Äî Git & Sync Strategy", file: "../playbook/04_git_strategy.md", type: "md", meta: "Version Control" },
                    { name: "05 ‚Äî Advisory Panel", file: "../playbook/05_advisory_panel.md", type: "md", meta: "Strategic Governance" },
                    { name: "06 ‚Äî Action Item Intel", file: "../playbook/06_action_items.md", type: "md", meta: "Capture & Completion" },
                    { name: "07 ‚Äî Client Operations", file: "../playbook/07_client_ops.md", type: "md", meta: "Onboarding & Delivery" },
                    { name: "08 ‚Äî Cloudflare Tunnel", file: "../playbook/08_cloudflare_tunnel.md", type: "md", meta: "Zero Trust ¬∑ Nomad Access" },
                ]
            },
            {
                section: "üè∑Ô∏è wnq Client Docs",
                color: "var(--green)",
                docs: [
                    { name: "wnq Ike Approach Plan", file: "docs/wnq_ike_approach_plan.md", type: "md", meta: "Client strategy" },
                ]
            },
            {
                section: "‚ö° black_nexus",
                color: "var(--green)",
                docs: [
                    { name: "BN Roadmap ‚Äî Feb 13", file: "../debriefs/bn_roadmap_2026_02_13.md", type: "md", meta: "Active tasks ¬∑ JB Scott" },
                    { name: "BN Debrief ‚Äî Feb 13", file: "../debriefs/bn_debrief_2026_02_13.md", type: "md", meta: "Status & Findings" },
                    { name: "GitHub Collaboration Guide", file: "../github_collaboration_guide_2026_02_10.md", type: "md", meta: "Git workflow ¬∑ Feb 10" },
                ]
            },

            {
                section: "üì¶ resources",
                color: "var(--orange)",
                docs: [
                    { name: "Dashboard Reference", file: "docs/dashboard_2026_02_08.pdf", type: "pdf", meta: "Resource ¬∑ Feb 8" },
                    { name: "Naming Conventions", file: "docs/naming_conventions_2026_02_08.pdf", type: "pdf", meta: "Resource ¬∑ Feb 8" },
                    { name: "Workflow Quick Reference", file: "docs/workflow_quick_reference_2026_02_08.pdf", type: "pdf", meta: "Resource ¬∑ Feb 8" },
                    { name: "Automation Tips & Tricks", file: "docs/automation_tips_and_tricks_2026_02_08.pdf", type: "pdf", meta: "Resource ¬∑ Feb 8" },
                ]
            },
            {
                section: "üìÖ Session Logs & Summaries",
                color: "var(--blue)",
                docs: [
                    { name: "Captain's Log ‚Äî Feb 14", file: "../resources/walkthroughs/captains_log_2026_02_14.md", type: "md", meta: "Active Session" },
                    { name: "Daily Summary ‚Äî Feb 14", file: "../resources/walkthroughs/daily_summary_2026_02_14.md", type: "md", meta: "Active Session" },

                    { name: "Workshop Review ‚Äî Feb 15", file: "../advisory_panel/consultations/markdown/panel_review_2026_02_15.md", type: "md", meta: "Latest Panel Review" },
                ]
            },
            {
                section: "üöÄ Career Research & Prep",
                color: "var(--blue)",
                docs: [
                    { name: "Screening Call (Feb 9)", file: "../career/docs/2026_02_09_screening_call.md", type: "md", meta: "Initial Intake" },
                    { name: "Interview questions Bank", file: "../career/docs/interview_questions.md", type: "md", meta: "Technical & Behavioral" },
                    { name: "Dossier: Panel Interview strategy", file: "../career/docs/panel_review_interview_strategy.md", type: "md", meta: "Strategic Prep" },
                    { name: "Reference Selection Plan", file: "../career/docs/reference_selection.md", type: "md", meta: "Vetting Standards" },
                    { name: "Salary Research & Market Stats", file: "../career/docs/salary_research.md", type: "md", meta: "Benchmarking" },
                    { name: "STAR Stories Bank", file: "../career/docs/star_stories_bank.md", type: "md", meta: "Impact Evidence" },
                    { name: "Thank You Email Drafts", file: "../career/docs/thank_you_email_draft.md", type: "md", meta: "Standard templates" },
                    { name: "Company Research Dossier", file: "../career/docs/company_research.md", type: "md", meta: "Target Intel" },
                    { name: "certifications Summary", file: "../career/docs/certifications_summary.md", type: "md", meta: "Evidence Vault" },
                ]
            }
        ];

        let currentDoc = null;
        let currentRawContent = '';

        // ==================== RENDER SIDEBAR ====================
        function renderSidebar(filter = '') {
            const sidebar = document.getElementById('docSidebar');
            const filterLower = filter.toLowerCase();

            sidebar.innerHTML = `
        <div class="doc-section">
          <div class="search-wrap" style="padding-top:12px;">
            <input class="search-input" type="text" placeholder="üîç Search documents..." 
                   oninput="renderSidebar(this.value)" value="${filter}">
          </div>
        </div>
      ` + DOCS.map((section, si) => {
                const filteredDocs = section.docs.filter(d =>
                    !filterLower || d.name.toLowerCase().includes(filterLower) || (d.meta || '').toLowerCase().includes(filterLower)
                );
                if (filterLower && filteredDocs.length === 0) return '';

                return `
          <div class="doc-section">
            <div class="section-header" onclick="toggleSection(${si})">
              <div class="section-label">
                <span>${section.section}</span>
              </div>
              <div style="display:flex;align-items:center;gap:8px;">
                <span class="section-count">${filteredDocs.length}</span>
                <span class="section-chevron" id="chevron-${si}">‚ñº</span>
              </div>
            </div>
            <div class="doc-list" id="section-${si}" style="max-height:500px;">
              ${filteredDocs.map(doc => `
                <div class="doc-item ${currentDoc === doc ? 'active' : ''}" onclick="openDoc(${JSON.stringify(doc).replace(/"/g, '&quot;')})">
                  <span class="doc-icon">${doc.type === 'pdf' ? 'üìÑ' : 'üìù'}</span>
                  <div class="doc-info">
                    <div class="doc-name">${doc.name}</div>
                    <div class="doc-meta">${doc.meta || ''}</div>
                  </div>
                  <span class="doc-badge badge-${doc.type}">${doc.type.toUpperCase()}</span>
                </div>
              `).join('')}
            </div>
          </div>
        `;
            }).join('');
        }

        function toggleSection(index) {
            const list = document.getElementById(`section-${index}`);
            const chevron = document.getElementById(`chevron-${index}`);
            const header = chevron.closest('.section-header');
            list.classList.toggle('collapsed');
            header.classList.toggle('collapsed');
        }

        // ==================== OPEN DOCUMENT ====================
        function openDoc(doc) {
            currentDoc = doc;
            renderSidebar(document.querySelector('.search-input')?.value || '');

            const title = document.getElementById('viewerTitle');
            const body = document.getElementById('viewerBody');
            const actions = document.getElementById('viewerActions');

            title.textContent = doc.name;

            if (doc.type === 'pdf') {
                // pdfs: show message with download link
                const pdfUrl = doc.repo
                    ? `https://github.com/${doc.repo}/blob/main/${doc.file}`
                    : doc.file;
                body.innerHTML = `
          <div class="viewer-empty">
            <div class="viewer-empty-icon">üìÑ</div>
            <div class="viewer-empty-text">pdf Document</div>
            <a href="${pdfUrl}" target="_blank" style="
              display:inline-flex;align-items:center;gap:6px;
              padding:10px 20px;background:var(--gold-dim);
              border:1px solid var(--gold);border-radius:8px;
              color:var(--gold);text-decoration:none;font-weight:600;
              font-size:0.85rem;margin-top:8px;
            ">üì• Open pdf</a>
          </div>
        `;
                actions.style.display = 'none';
                return;
            }

            if (doc.type === 'html') {
                // HTML: render in iframe for full styling
                body.innerHTML = `<iframe src="${doc.file}" style="width:100%;height:100%;border:none;background:#fff;border-radius:8px;"></iframe>`;
                actions.style.display = 'none';
                return;
            }

            // markdown: fetch and render
            body.innerHTML = '<div class="viewer-loading">Loading document</div>';
            actions.style.display = 'flex';

            let fetchUrl;
            if (doc.repo) {
                fetchUrl = `https://raw.githubusercontent.com/${doc.repo}/main/${doc.file}`;
            } else {
                fetchUrl = doc.file;
            }

            fetch(fetchUrl)
                .then(r => {
                    if (!r.ok) throw new Error(`HTTP ${r.status}`);
                    return r.text();
                })
                .then(md => {
                    currentRawContent = md;
                    body.innerHTML = `<div class="md-content">${rendermarkdown(md)}</div>`;
                })
                .catch(err => {
                    const githubUrl = doc.repo
                        ? `https://github.com/${doc.repo}/blob/main/${doc.file}`
                        : doc.file;
                    body.innerHTML = `
            <div class="viewer-empty">
              <div class="viewer-empty-icon">‚ö†Ô∏è</div>
              <div class="viewer-empty-text">Could not fetch document</div>
              <div style="font-size:0.75rem;color:var(--text-dim);margin-top:4px;">${err.message}</div>
              <a href="${githubUrl}" target="_blank" style="
                display:inline-flex;align-items:center;gap:6px;
                padding:8px 16px;background:var(--blue-dim);
                border:1px solid var(--blue);border-radius:8px;
                color:var(--blue);text-decoration:none;font-weight:500;
                font-size:0.82rem;margin-top:12px;
              ">üîó View on GitHub</a>
            </div>
          `;
                });
        }

        // ==================== MARKDOWN RENDERER ====================
        function rendermarkdown(md) {
            // 1. Extract fenced code blocks first (protect from processing)
            const codeBlocks = [];
            md = md.replace(/```([\w]*)\n([\s\S]*?)```/g, (_, lang, code) => {
                const i = codeBlocks.length;
                codeBlocks.push(`<pre><code>${code.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').trim()}</code></pre>`);
                return `\x00CB${i}\x00`;
            });

            // 2. Escape HTML in remaining content
            md = md.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');

            let html = md;

            // 3. Headers
            html = html.replace(/^#### (.+)$/gm, '<h4>$1</h4>');
            html = html.replace(/^### (.+)$/gm, '<h3>$1</h3>');
            html = html.replace(/^## (.+)$/gm, '<h2>$1</h2>');
            html = html.replace(/^# (.+)$/gm, '<h1>$1</h1>');

            // 4. Horizontal rules
            html = html.replace(/^---+$/gm, '<hr>');

            // 5. Blockquotes (match escaped &gt;)
            html = html.replace(/^&gt; (.+)$/gm, '<blockquote>$1</blockquote>');
            html = html.replace(/<\/blockquote>\n<blockquote>/g, '<br>');

            // 6. Bold and italic
            html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');

            // 7. Inline code
            html = html.replace(/`([^`]+)`/g, '<code>$1</code>');

            // 8. Links  [text](url)
            html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" style="color:var(--gold);text-decoration:underline">$1</a>');

            // 9. Checkboxes
            html = html.replace(/^- \[x\] (.+)$/gm, '<li><input type="checkbox" checked disabled> $1</li>');
            html = html.replace(/^- \[ \] (.+)$/gm, '<li><input type="checkbox" disabled> $1</li>');

            // 10. Unordered and ordered lists
            html = html.replace(/^- (.+)$/gm, '<li>$1</li>');
            html = html.replace(/^\d+\. (.+)$/gm, '<li>$1</li>');
            html = html.replace(/((<li>.*<\/li>\n?)+)/g, '<ul>$1</ul>');

            // 11. Tables
            html = html.replace(/^(\|.+\|)\n(\|[-| :]+\|)\n((?:\|.+\|\n?)*)/gm, (_, header, align, rows) => {
                const headers = header.split('|').filter(c => c.trim());
                const rowList = rows.trim().split('\n').filter(Boolean);
                return `<table>
          <thead><tr>${headers.map(h => `<th>${h.trim()}</th>`).join('')}</tr></thead>
          <tbody>${rowList.map(row => {
                    const cells = row.split('|').filter(c => c.trim());
                    return `<tr>${cells.map(c => `<td>${c.trim()}</td>`).join('')}</tr>`;
                }).join('')}</tbody>
        </table>`;
            });

            // 12. Paragraphs (lines not already wrapped in HTML tags)
            html = html.replace(/^(?!<[a-z/]|$|\x00)(.+)$/gm, '<p>$1</p>');

            // 13. Clean up empty paragraphs
            html = html.replace(/<p>\s*<\/p>/g, '');

            // 14. Restore code blocks
            html = html.replace(/\x00CB(\d+)\x00/g, (_, i) => codeBlocks[i]);

            return html;
        }

        // ==================== UTILITIES ====================
        function copyDocContent() {
            if (!currentRawContent) return;
            navigator.clipboard.writeText(currentRawContent).then(() => {
                const btn = document.getElementById('copyBtn');
                btn.textContent = '‚úÖ Copied';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'üìã Copy';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        function openRawLink() {
            if (!currentDoc) return;
            const url = currentDoc.repo
                ? `https://github.com/${currentDoc.repo}/blob/main/${currentDoc.file}`
                : currentDoc.file;
            window.open(url, '_blank');
        }

        // ==================== INIT ====================
        renderSidebar();

        // Auto-open first doc if on desktop
        if (window.innerWidth > 900 && DOCS[0]?.docs[0]) {
            openDoc(DOCS[0].docs[0]);
        }
    </script>
</body>

</html>